<ion-header class="modal-header">
  <ion-toolbar>
    <div class="header-content">
      <div class="header-icon">
        <ion-icon name="bulb-outline"></ion-icon>
      </div>
      <div class="header-text">
        <h1 class="modal-title">{{ 'submitIdea.title' | translate }}</h1>
        <p class="modal-subtitle">{{ 'submitIdea.subtitle' | translate }}</p>
      </div>
    </div>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()" [disabled]="isSubmitting()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="modal-content">
  <div class="content-wrapper">
    
    <!-- Loading State -->
    <div *ngIf="isSubmitting()" class="progress-wrapper">
      <ion-progress-bar type="indeterminate" color="primary"></ion-progress-bar>
      <p>{{ 'submitIdea.processing' | translate }}</p>
    </div>

    <!-- Error Summary -->
    <ion-card *ngIf="formErrors().length > 0" class="error-card">
      <ion-card-content>
        <div *ngFor="let error of formErrors()" class="error-line">
          <ion-icon name="alert-circle-outline"></ion-icon> {{ error | translate }}
        </div>
      </ion-card-content>
    </ion-card>

    <!-- FORMULARIO -->
    <form *ngIf="ideaForm" [formGroup]="ideaForm" class="idea-form">

      <!-- SECCIÓN: IDEA -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">
            <ion-icon name="bulb-outline"></ion-icon>
          </div>
          <h3 class="section-title">{{ 'submitIdea.sections.idea' | translate }}</h3>
        </div>

        <div class="section-content">
          <!-- Título -->
          <ion-item class="form-item primary-field" [class.ion-invalid]="isFieldInvalid('title')">
            <ion-input
              label="{{ 'submitIdea.projectTitle' | translate }}"
              labelPlacement="floating"
              formControlName="title"
              type="text"
              [counter]="true"
              maxlength="100"
              [disabled]="isSubmitting()">
            </ion-input>
            <ion-note slot="error" *ngIf="isFieldInvalid('title')">
              {{ getFieldError('title') | translate }}
            </ion-note>
          </ion-item>

          <!-- Descripción -->
          <ion-item class="form-item textarea-item primary-field" [class.ion-invalid]="isFieldInvalid('description')">
            <ion-textarea
              label="{{ 'submitIdea.description' | translate }}"
              labelPlacement="floating"
              formControlName="description"
              [counter]="true"
              maxlength="2000"
              rows="4"
              [autoGrow]="true"
              [disabled]="isSubmitting()">
            </ion-textarea>
            <ion-note slot="error" *ngIf="isFieldInvalid('description')">
              {{ getFieldError('description') | translate }}
            </ion-note>
          </ion-item>
        </div>
      </div>

      <!-- SECCIÓN: CONTACTO -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">
            <ion-icon name="person-outline"></ion-icon>
          </div>
          <h3 class="section-title">{{ 'submitIdea.sections.contact' | translate }}</h3>
        </div>

        <div class="section-content">
          <!-- Email -->
          <ion-item class="form-item contact-field" [class.ion-invalid]="isFieldInvalid('email')">
            <ion-input
              label="{{ 'submitIdea.contactEmail' | translate }}"
              labelPlacement="floating"
              formControlName="email"
              type="email"
              inputmode="email"
              [disabled]="isSubmitting()">
            </ion-input>
            <ion-note slot="error" *ngIf="isFieldInvalid('email')">
              {{ getFieldError('email') | translate }}
            </ion-note>
          </ion-item>

          <!-- Nombres (Grid Layout - 2 columnas) -->
          <div class="name-grid">
            <!-- First Name -->
            <ion-item class="form-item name-field" [class.ion-invalid]="isFieldInvalid('firstName')">
              <ion-input
                label="{{ 'submitIdea.firstName' | translate }}"
                labelPlacement="floating"
                formControlName="firstName"
                type="text"
                maxlength="50"
                [disabled]="isSubmitting()">
              </ion-input>
              <ion-note slot="error" *ngIf="isFieldInvalid('firstName')">
                {{ getFieldError('firstName') | translate }}
              </ion-note>
            </ion-item>

            <!-- Last Name -->
            <ion-item class="form-item name-field" [class.ion-invalid]="isFieldInvalid('lastName')">
              <ion-input
                label="{{ 'submitIdea.lastName' | translate }}"
                labelPlacement="floating"
                formControlName="lastName"
                type="text"
                maxlength="50"
                [disabled]="isSubmitting()">
              </ion-input>
              <ion-note slot="error" *ngIf="isFieldInvalid('lastName')">
                {{ getFieldError('lastName') | translate }}
              </ion-note>
            </ion-item>
          </div>

          <!-- Phone Number -->
          <ion-item class="form-item contact-field" [class.ion-invalid]="isFieldInvalid('phoneNumber')">
            <ion-input
              label="{{ 'submitIdea.phoneNumber' | translate }}"
              labelPlacement="floating"
              formControlName="phoneNumber"
              type="tel"
              inputmode="tel"
              placeholder="+1234567890"
              [disabled]="isSubmitting()">
            </ion-input>
            <ion-note slot="error" *ngIf="isFieldInvalid('phoneNumber')">
              {{ getFieldError('phoneNumber') | translate }}
            </ion-note>
          </ion-item>

          <!-- Address -->
          <ion-item class="form-item contact-field address-field" [class.ion-invalid]="isFieldInvalid('address')">
            <ion-input
              label="{{ 'submitIdea.address' | translate }}"
              labelPlacement="floating"
              formControlName="address"
              type="text"
              maxlength="200"
              [disabled]="isSubmitting()">
            </ion-input>
            <ion-note slot="error" *ngIf="isFieldInvalid('address')">
              {{ getFieldError('address') | translate }}
            </ion-note>
          </ion-item>
        </div>
      </div>

      <!-- SECCIÓN: FINANCIAMIENTO -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">
            <ion-icon name="cash-outline"></ion-icon>
          </div>
          <h3 class="section-title">{{ 'submitIdea.sections.financial' | translate }}</h3>
        </div>

        <div class="section-content">
          <!-- Funding Goal Info -->
          <div class="funding-info" *ngIf="maxFundingLimit() > 0">
            <ion-icon name="information-circle-outline"></ion-icon>
            <span>{{ 'submitIdea.fundingInfo' | translate:{limit: (maxFundingLimit() | currency:'USD':'symbol':'1.0-0')} }}</span>
          </div>

          <!-- Funding Goal -->
          <ion-item class="form-item funding-goal-item financial-field" [class.ion-invalid]="isFieldInvalid('fundingGoal')">
            <ion-input
              label="{{ 'submitIdea.fundingGoal' | translate }}"
              labelPlacement="floating"
              formControlName="fundingGoal"
              type="number"
              min="1"
              [max]="maxFundingLimit()"
              step="0.01"
              [disabled]="isSubmitting()"
              [placeholder]="'Max: ' + (maxFundingLimit() | currency:'USD':'symbol':'1.0-0')">
            </ion-input>
            <div class="currency-prefix">$</div>
            <ion-note slot="error" *ngIf="isFieldInvalid('fundingGoal')">
              {{ getFieldError('fundingGoal') | translate }}
            </ion-note>
          </ion-item>
        </div>
      </div>

      <!-- SECCIÓN DE PAGO -->
      <div class="payment-section">
        <p class="section-label">{{ 'submitIdea.paymentSection' | translate }}</p>

        <div class="payment-grid">
          
          <!-- Stripe -->
          <div class="payment-card stripe-card"
               [class.active]="ideaForm.valid && !isSubmitting()"
               [class.processing]="isSubmitting() && selectedPaymentMethod() === PAYMENT_METHODS.STRIPE"
               (click)="onSubmit(PAYMENT_METHODS.STRIPE)">
            
            <div class="card-icon">
              <ion-icon name="card-outline"></ion-icon>
            </div>
            <div class="card-info">
              <h4>{{ 'submitIdea.stripeTitle' | translate }}</h4>
              <p>{{ 'submitIdea.stripeDescription' | translate }}</p>
            </div>
            <div class="card-price">
              $9.99
              <ion-spinner *ngIf="isSubmitting() && selectedPaymentMethod() === PAYMENT_METHODS.STRIPE" name="crescent"></ion-spinner>
            </div>
          </div>

          <!-- PayPal -->
          <div class="payment-card paypal-card"
               [class.active]="ideaForm.valid && !isSubmitting()"
               [class.processing]="isSubmitting() && selectedPaymentMethod() === PAYMENT_METHODS.PAYPAL"
               (click)="onSubmit(PAYMENT_METHODS.PAYPAL)">
            
            <div class="card-icon">
              <ion-icon name="logo-paypal"></ion-icon>
            </div>
            <div class="card-info">
              <h4>{{ 'submitIdea.paypalTitle' | translate }}</h4>
              <p>{{ 'submitIdea.paypalDescription' | translate }}</p>
            </div>
            <div class="card-price">
              $9.99
              <ion-spinner *ngIf="isSubmitting() && selectedPaymentMethod() === PAYMENT_METHODS.PAYPAL" name="crescent"></ion-spinner>
            </div>
          </div>

          <!-- Apple Pay -->
          <div class="payment-card apple-pay-card"
               [class.active]="ideaForm.valid && !isSubmitting()"
               [class.processing]="isSubmitting() && selectedPaymentMethod() === PAYMENT_METHODS.APPLE_PAY"
               (click)="onSubmit(PAYMENT_METHODS.APPLE_PAY)">
            
            <div class="card-icon">
              <ion-icon name="logo-apple"></ion-icon>
            </div>
            <div class="card-info">
              <h4>{{ 'submitIdea.applePayTitle' | translate }}</h4>
              <p>{{ 'submitIdea.applePayDescription' | translate }}</p>
            </div>
            <div class="card-price">
              $9.99
              <ion-spinner *ngIf="isSubmitting() && selectedPaymentMethod() === PAYMENT_METHODS.APPLE_PAY" name="crescent"></ion-spinner>
            </div>
          </div>

        </div>
      </div>

    </form>
  </div>
</ion-content>